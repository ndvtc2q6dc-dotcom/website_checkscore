<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡åˆ‘é¢„è­¦ç³»ç»Ÿ</title>
    <!-- Faviconè®¾ç½® -->
    <link rel="icon" href="asset/images/icon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="asset/images/icon.ico" type="image/x-icon">
    <link rel="icon" href="asset/images/icon.ico" sizes="16x16" type="image/x-icon">
    <link rel="icon" href="asset/images/icon.ico" sizes="32x32" type="image/x-icon">
    <link rel="apple-touch-icon" href="asset/images/icon.ico">
    <meta name="msapplication-TileImage" content="asset/images/icon.ico">
    <meta name="theme-color" content="#1e40af">
    <!-- å¼ºåˆ¶åˆ·æ–°favicon -->
    <script>
        // å¼ºåˆ¶åˆ·æ–°favicon
        setTimeout(function() {
            var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
            link.type = 'image/x-icon';
            link.rel = 'shortcut icon';
            link.href = 'asset/images/icon.ico?' + new Date().getTime();
            document.getElementsByTagName('head')[0].appendChild(link);
        }, 100);
    </script>
    <!-- å¤–éƒ¨ CSS æ ·å¼ -->
    <link rel="stylesheet" href="asset/css/style.css">
    
    <!-- å…¼å®¹æ€§æç¤º -->
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/es5-shim@4.5.15/es5-shim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es5-shim@4.5.15/es5-sham.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    
    <!-- å…¼å®¹æ€§å¤„ç† -->
    <script>
        // ä¸ºä½ç‰ˆæœ¬æµè§ˆå™¨æ·»åŠ å…¼å®¹æ€§æ”¯æŒ
        (function() {
            // æ·»åŠ  Array.includes çš„ polyfill
            if (!Array.prototype.includes) {
                Array.prototype.includes = function(searchElement) {
                    for (var i = 0; i < this.length; i++) {
                        if (this[i] === searchElement) {
                            return true;
                        }
                    }
                    return false;
                };
            }
            
            // æ·»åŠ  String.includes çš„ polyfill
            if (!String.prototype.includes) {
                String.prototype.includes = function(search, start) {
                    if (typeof start !== 'number') {
                        start = 0;
                    }
                    if (start + search.length > this.length) {
                        return false;
                    } else {
                        return this.indexOf(search, start) !== -1;
                    }
                };
            }
            
            // æ·»åŠ  Object.keys çš„ polyfill
            if (!Object.keys) {
                Object.keys = (function() {
                    var hasOwnProperty = Object.prototype.hasOwnProperty,
                        hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),
                        dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],
                        dontEnumsLength = dontEnums.length;
                    return function(obj) {
                        if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {
                            throw new TypeError('Object.keys called on non-object');
                        }
                        var result = [], prop, i;
                        for (prop in obj) {
                            if (hasOwnProperty.call(obj, prop)) {
                                result.push(prop);
                            }
                        }
                        if (hasDontEnumBug) {
                            for (i = 0; i < dontEnumsLength; i++) {
                                if (hasOwnProperty.call(obj, dontEnums[i])) {
                                    result.push(dontEnums[i]);
                                }
                            }
                        }
                        return result;
                    };
                }());
            }
            
            // æ·»åŠ  String.padStart çš„ polyfill
            if (!String.prototype.padStart) {
                String.prototype.padStart = function(targetLength, padString) {
                    targetLength = targetLength >> 0;
                    padString = String(typeof padString !== 'undefined' ? padString : ' ');
                    if (this.length > targetLength) {
                        return String(this);
                    } else {
                        targetLength = targetLength - this.length;
                        if (targetLength > padString.length) {
                            padString += padString.repeat(targetLength / padString.length);
                        }
                        return padString.slice(0, targetLength) + String(this);
                    }
                };
            }
            
            // æ·»åŠ  String.repeat çš„ polyfillï¼ˆpadStartéœ€è¦ï¼‰
            if (!String.prototype.repeat) {
                String.prototype.repeat = function(count) {
                    if (this == null) {
                        throw new TypeError('can\'t convert ' + this + ' to object');
                    }
                    var str = '' + this;
                    count = +count;
                    if (count != count) {
                        count = 0;
                    }
                    if (count < 0) {
                        throw new RangeError('repeat count must be non-negative');
                    }
                    if (count == Infinity) {
                        throw new RangeError('repeat count must be less than infinity');
                    }
                    count = Math.floor(count);
                    if (str.length == 0 || count == 0) {
                        return '';
                    }
                    if (str.length * count >= 1 << 28) {
                        throw new RangeError('repeat count must not overflow maximum string size');
                    }
                    var rpt = '';
                    for (var i = 0; i < count; i++) {
                        rpt += str;
                    }
                    return rpt;
                };
            }
            
            // æ·»åŠ  Element.remove çš„ polyfill
            if (!Element.prototype.remove) {
                Element.prototype.remove = function() {
                    if (this.parentNode) {
                        this.parentNode.removeChild(this);
                    }
                };
            }
            
            // æ·»åŠ  Array.from çš„ polyfill
            if (!Array.from) {
                Array.from = function(arrayLike, mapFn, thisArg) {
                    var C = this;
                    var items = Object(arrayLike);
                    if (arrayLike == null) {
                        throw new TypeError('Array.from requires an array-like object - not null or undefined');
                    }
                    var mapFunction = mapFn !== undefined ? mapFn : undefined;
                    var T;
                    if (typeof mapFn === 'function') {
                        if (arguments.length > 2) {
                            T = thisArg;
                        }
                    }
                    var len = parseInt(items.length) || 0;
                    var A = typeof C === 'function' ? Object(new C(len)) : new Array(len);
                    var k = 0;
                    var kValue;
                    while (k < len) {
                        kValue = items[k];
                        if (mapFunction) {
                            A[k] = typeof T === 'undefined' ? mapFunction(kValue, k) : mapFunction.call(T, kValue, k);
                        } else {
                            A[k] = kValue;
                        }
                        k += 1;
                    }
                    A.length = len;
                    return A;
                };
            }
            
            // æ·»åŠ  Array.find çš„ polyfill
            if (!Array.prototype.find) {
                Array.prototype.find = function(predicate) {
                    if (this == null) {
                        throw new TypeError('Array.prototype.find called on null or undefined');
                    }
                    if (typeof predicate !== 'function') {
                        throw new TypeError('predicate must be a function');
                    }
                    var list = Object(this);
                    var length = parseInt(list.length) || 0;
                    var thisArg = arguments[1];
                    var value;
                    for (var i = 0; i < length; i++) {
                        value = list[i];
                        if (predicate.call(thisArg, value, i, list)) {
                            return value;
                        }
                    }
                    return undefined;
                };
            }
            
            // æ·»åŠ  Array.filter çš„ polyfillï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!Array.prototype.filter) {
                Array.prototype.filter = function(fun, thisArg) {
                    if (this === void 0 || this === null) {
                        throw new TypeError();
                    }
                    var t = Object(this);
                    var len = parseInt(t.length) || 0;
                    if (typeof fun !== 'function') {
                        throw new TypeError();
                    }
                    var res = [];
                    var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
                    for (var i = 0; i < len; i++) {
                        if (i in t) {
                            var val = t[i];
                            if (fun.call(thisArg, val, i, t)) {
                                res.push(val);
                            }
                        }
                    }
                    return res;
                };
            }
            
            // æ·»åŠ  Array.forEach çš„ polyfillï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!Array.prototype.forEach) {
                Array.prototype.forEach = function(callback, thisArg) {
                    var T, k;
                    if (this == null) {
                        throw new TypeError('this is null or not defined');
                    }
                    var O = Object(this);
                    var len = parseInt(O.length) || 0;
                    if (typeof callback !== 'function') {
                        throw new TypeError(callback + ' is not a function');
                    }
                    if (arguments.length > 1) {
                        T = thisArg;
                    }
                    k = 0;
                    while (k < len) {
                        var kValue;
                        if (k in O) {
                            kValue = O[k];
                            callback.call(T, kValue, k, O);
                        }
                        k++;
                    }
                };
            }
            
            // æ·»åŠ  Array.reduce çš„ polyfillï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!Array.prototype.reduce) {
                Array.prototype.reduce = function(callback, initialValue) {
                    if (this === null || this === undefined) {
                        throw new TypeError('Array.prototype.reduce called on null or undefined');
                    }
                    if (typeof callback !== 'function') {
                        throw new TypeError(callback + ' is not a function');
                    }
                    var t = Object(this);
                    var len = parseInt(t.length) || 0;
                    var k = 0;
                    var value;
                    if (arguments.length >= 2) {
                        value = arguments[1];
                    } else {
                        while (k < len && !(k in t)) {
                            k++;
                        }
                        if (k >= len) {
                            throw new TypeError('Reduce of empty array with no initial value');
                        }
                        value = t[k++];
                    }
                    while (k < len) {
                        if (k in t) {
                            value = callback(value, t[k], k, t);
                        }
                        k++;
                    }
                    return value;
                };
            }
            
            // æ·»åŠ  Array.map çš„ polyfillï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!Array.prototype.map) {
                Array.prototype.map = function(callback, thisArg) {
                    var T, A, k;
                    if (this == null) {
                        throw new TypeError('this is null or not defined');
                    }
                    var O = Object(this);
                    var len = parseInt(O.length) || 0;
                    if (typeof callback !== 'function') {
                        throw new TypeError(callback + ' is not a function');
                    }
                    if (arguments.length > 1) {
                        T = thisArg;
                    }
                    A = new Array(len);
                    k = 0;
                    while (k < len) {
                        var kValue, mappedValue;
                        if (k in O) {
                            kValue = O[k];
                            mappedValue = callback.call(T, kValue, k, O);
                            A[k] = mappedValue;
                        }
                        k++;
                    }
                    return A;
                };
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="admin-toggle">
                <button class="visitor-btn" onclick="showLoginForm()" id="loginBtn">ç®¡ç†å‘˜ç™»å½•</button>
                <button class="admin-btn" onclick="logout()" id="logoutBtn" style="display: none;">é€€å‡ºç®¡ç†å‘˜</button>
            </div>
            <div class="header-content">
                <img src="asset/images/icon.ico" alt="ç³»ç»Ÿå›¾æ ‡" class="header-icon">
                <h1>å‡åˆ‘é¢„è­¦ç³»ç»Ÿ</h1>
            </div>
        </div>

        <div class="tabs">
            <button class="tab visitor-only" onclick="switchTab('analysis')">
                è€ƒæ ¸æœŸæ‰£åˆ†
            </button>
            <button class="tab visitor-only" onclick="switchTab('waiting')">
                å¾…è£å®šç½ªçŠ¯æ‰£åˆ†æƒ…å†µ
            </button>
            <button class="tab visitor-only" onclick="switchTab('screening')">
                å‡åˆ‘ç­›æŸ¥æ•°æ®
            </button>
            <button class="tab visitor-only" onclick="switchTab('score')">
                åŠ æ‰£åˆ†å…¬ç¤ºè¡¨
            </button>
            <button class="tab visitor-only" onclick="switchTab('guidance')">
                åˆ‘åŠ¡å·¥ä½œæŒ‡å¼•
            </button>
            <button class="tab admin-only" onclick="switchTab('upload')">
                æ–‡ä»¶ä¸Šä¼ è½¬æ¢
            </button>
        </div>

        <!-- è€ƒæ ¸æœŸæ‰£åˆ†æ ‡ç­¾é¡µ -->
        <div id="analysis-tab" class="tab-content visitor-only">
            <div class="visitor-notice visitor-only" id="visitorNotice">
                <div class="notice-content">
                    <strong>è®¿å®¢æ¨¡å¼ï¼š</strong>æ‚¨å½“å‰ä»¥è®¿å®¢èº«ä»½è®¿é—®ç³»ç»Ÿï¼Œåªèƒ½æŸ¥çœ‹æ•°æ®ã€‚å¦‚éœ€è¿›å…¥ç®¡ç†åŠŸèƒ½ï¼Œè¯·è”ç³»ç®¡ç†å‘˜è·å–æƒé™ã€‚
                    <div class="countdown-timer" id="countdownTimer" style="font-size: 0.9em; color: #666; margin-top: 5px;">
                        <span id="countdownText">6ç§’åè‡ªåŠ¨å…³é—­</span>
                    </div>
                </div>
                <button class="close-btn" onclick="closeVisitorNotice()" title="å…³é—­æç¤º">Ã—</button>
            </div>
            <div class="search-section" style="margin: 4px 0;">
                <h4 style="margin-bottom: 3px; color: #1e3a8a; font-size: 0.8em;">åˆ†æå‚æ•°è®¾ç½®</h4>
                <div class="search-row" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                    <div class="search-item" style="display: flex; align-items: center; gap: 6px; min-width: 300px;">
                        <label style="margin: 0; white-space: nowrap; font-size: 0.9em;">åˆ†ææ—¶é—´æ®µ</label>
                        <select id="timeRangeType" onchange="updateTimeRangeDescription()" style="flex: 1; min-width: 200px;">
                            <option value="recent">è€ƒæ ¸æœŸæ­¢æ—¥å‰åŠå¹´è‡³ä»Š</option>
                            <option value="qualification">è€ƒæ ¸æœŸæ­¢æ—¥å‰ä¸€å¹´è‡³ä»Š</option>
                        </select>
                    </div>
                    <div class="search-item" style="display: flex; align-items: center; gap: 6px; min-width: 200px;">
                        <label style="margin: 0; white-space: nowrap; font-size: 0.9em;">ç­›é€‰æ¡ä»¶</label>
                        <select id="filterCondition" onchange="updateTimeRangeDescription(); toggleTableColumns();" style="flex: 1; min-width: 150px;">
                            <option value="count2">æ‰£åˆ†æ¬¡æ•° â‰¥ 2æ¬¡</option>
                            <option value="count1">æ‰£åˆ†æ¬¡æ•° = 1æ¬¡</option>
                            <option value="lifesentence">ä½™åˆ‘ä¸ºæ— æœŸ</option>
                        </select>
                    </div>
                </div>
                <div id="timeRangeDescription" style="margin-top: 4px; padding: 4px; background: #dbeafe; border-radius: 2px; color: #1e3a8a; font-size: 10px;">
                    å°†åˆ†æè¿‘åŠå¹´ï¼ˆå½“å‰æ—¥æœŸå¾€å‰åŠå¹´ï¼‰å†…æ‰£åˆ†æ¬¡æ•°å¤§äºç­‰äº2æ¬¡çš„äººå‘˜
                </div>
            </div>

            <div id="analysis-content" style="display: none;">
                <div class="stats">
                    <div class="stat-card" style="text-align: center;">
                        <h3 id="analysisDeductionLabel" style="margin-bottom: 2px; font-size: 18px;">æ‰£åˆ†æ¬¡æ•°â‰¥2æ¬¡äººæ•°</h3>
                        <div class="stat-card number" id="analysisDeduction" style="font-size: 24px;">0</div>
                    </div>
                </div>




                <div class="export-buttons admin-only">
                    <button class="btn btn-success" onclick="exportAnalysisData()">ğŸ“¥ å¯¼å‡ºåˆ†æç»“æœ</button>
                    <button class="btn btn-success" onclick="exportAnalysisReport()">ğŸ“Š å¯¼å‡ºåˆ†ææŠ¥å‘Š</button>
                </div>

                <div id="analysisTableContainer">
                    <table class="data-table" id="analysisTable">
                        <colgroup>
                            <col style="width: 60px;">  <!-- åºå· -->
                            <col style="width: 80px;">  <!-- å§“å -->
                            <col style="width: 100px;"> <!-- å›šå· -->
                            <col class="crime-column" style="display: none; width: 180px;"> <!-- ç½ªå -->
                            <col style="width: 150px;"> <!-- åˆ†ææ—¶é—´æ®µ -->
                            <col style="width: 100px;"> <!-- æ€»æ‰£åˆ† -->
                            <col style="width: 120px;"> <!-- æ‰£åˆ†è®°å½•æ•° -->
                            <col style="width: 180px;"> <!-- å‡åˆ‘æ¨æµ‹ç»“è®º -->
                            <col style="width: 150px;"> <!-- å¤‡æ³¨ -->
                            <col style="width: 80px;">  <!-- æ“ä½œ -->
                        </colgroup>
                        <thead>
                            <tr>
                                <th>åºå·</th>
                                <th>å§“å</th>
                                <th>å›šå·</th>
                                <th class="crime-column" style="display: none;">ç½ªå</th>
                                <th>åˆ†ææ—¶é—´æ®µ</th>
                                <th>æ€»æ‰£åˆ†</th>
                                <th>æ‰£åˆ†è®°å½•æ•°</th>
                                <th>å‡åˆ‘æ¨æµ‹ç»“è®º</th>
                                <th>å¤‡æ³¨</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="analysisTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é¡µæ§åˆ¶åŒºåŸŸ -->
                <div class="pagination" id="analysisPagination">
                    <button onclick="prevAnalysisPage()" id="prevAnalysisBtn">ä¸Šä¸€é¡µ</button>
                    <span id="analysisPageInfo">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                    <button onclick="nextAnalysisPage()" id="nextAnalysisBtn">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶ç®¡ç†æ ‡ç­¾é¡µï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰ -->
        <div id="upload-tab" class="tab-content admin-only">
            <div class="file-upload-section">
                <h4 style="margin-bottom: 6px; color: #1e3a8a; font-size: 1.1em; font-weight: 600;">ğŸ“ æ–‡ä»¶ä¸Šä¼ è½¬æ¢</h4>
                <p style="margin-bottom: 12px; color: #64748b; font-size: 0.9em;">
                    æ”¯æŒä¸Šä¼ Excelæ–‡ä»¶(.xlsx/.xls)ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹å¹¶è½¬æ¢ä¸ºJSONæ ¼å¼
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 12px;">
                    <label for="screeningFile" class="file-label">
                        ä¸Šä¼ å‡åˆ‘ç­›æŸ¥æ–‡ä»¶
                        <input type="file" id="screeningFile" class="file-input" accept=".xlsx,.xls" onchange="handleFileUpload('screening', this)">
                    </label>
                    
                    <label for="scoreFile" class="file-label">
                        ä¸Šä¼ åŠ æ‰£åˆ†æ–‡ä»¶
                        <input type="file" id="scoreFile" class="file-input" accept=".xlsx,.xls" onchange="handleFileUpload('score', this)">
                    </label>
                    
                    <label for="recommendationFile" class="file-label">
                        ä¸Šä¼ æ¨èæ¦œæ–‡ä»¶
                        <input type="file" id="recommendationFile" class="file-input" accept=".xlsx,.xls" onchange="handleFileUpload('recommendation', this)">
                    </label>
                    
                    <label for="remainingFile" class="file-label">
                        ä¸Šä¼ ä½™åˆ‘æ–‡ä»¶
                        <input type="file" id="remainingFile" class="file-input" accept=".xlsx,.xls" onchange="handleFileUpload('remaining', this)">
                    </label>
                </div>
                
                <div id="uploadResults" style="margin-top: 15px; display: none;">
                    <h5 style="color: #1e3a8a; margin-bottom: 10px; font-size: 1em;">è½¬æ¢ç»“æœï¼š</h5>
                    <div id="convertedFiles" style="padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                        <!-- è½¬æ¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ç­‰å¾…è£å®šæ‰£åˆ†æ ‡ç­¾é¡µ -->
        <div id="waiting-tab" class="tab-content visitor-only">
            <div class="search-section" style="margin: 3px 0;">
                <h4 style="margin-bottom: 2px; color: #1e3a8a; font-size: 0.8em;">ç­‰å¾…è£å®šæ‰£åˆ†åˆ†æ</h4>
                <div class="search-row">
                    <div class="search-item" style="display: flex; align-items: center; gap: 8px;">
                        <label style="margin: 0; white-space: nowrap;">åˆ†æç”³æŠ¥æœˆä»½</label>
                        <select id="waitingMonth" onchange="updateWaitingDescription()" style="flex: 1; min-width: 120px;">
                            <!-- æœˆä»½é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                </div>
                <div id="waitingDescription" style="margin-top: 2px; padding: 2px 4px; background: #dbeafe; border-radius: 2px; color: #1e3a8a; font-size: 12px;">
                    æ­£åœ¨åŠ è½½æœˆä»½é€‰é¡¹...
                </div>
            </div>

            <div id="waiting-content" style="display: none;">
                <div class="stats">
                    <div class="stat-card">
                        <h3>æ¨èäººå‘˜æ€»æ•°</h3>
                        <div class="stat-card number" id="waitingTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>æœ‰æ‰£åˆ†è®°å½•äººæ•°</h3>
                        <div class="stat-card number" id="waitingDeduction">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>æ‰£åˆ†äººå‘˜å æ¯”</h3>
                        <div class="stat-card number" id="waitingPercentage">0%</div>
                    </div>
                </div>


                <div class="table-container">
                    <table class="data-table">
                        <colgroup>
                            <col style="width: 60px;">  <!-- åºå· -->
                            <col style="width: 80px;">  <!-- å§“å -->
                            <col style="width: 100px;"> <!-- å›šå· -->
                            <col style="width: 120px;"> <!-- å‰©ä½™åˆ‘æœŸ -->
                            <col style="width: 150px;"> <!-- æè¯·å¹…åº¦ -->
                            <col style="width: 150px;"> <!-- åˆ†ç›‘åŒº -->
                            <col style="width: 180px;"> <!-- åˆ†ææ—¶é—´æ®µ -->
                            <col style="width: 100px;"> <!-- 11ä¸ªæœˆå†…æ‰£åˆ†æ¬¡æ•° -->
                            <col style="width: 70px;">  <!-- æ€»æ‰£åˆ† -->
                            <col style="width: 120px;"> <!-- æ‰£åˆ†è¯¦æƒ… -->
                        </colgroup>
                        <thead>
                            <tr>
                                <th>åºå·</th>
                                <th>å§“å</th>
                                <th>å›šå·</th>
                                <th>å‰©ä½™åˆ‘æœŸ</th>
                                <th>æè¯·å¹…åº¦</th>
                                <th>åˆ†ç›‘åŒº</th>
                                <th>åˆ†ææ—¶é—´æ®µ</th>
                                <th>11ä¸ªæœˆå†…æ‰£åˆ†æ¬¡æ•°</th>
                                <th>æ€»æ‰£åˆ†</th>
                                <th>æ‰£åˆ†è¯¦æƒ…</th>
                            </tr>
                        </thead>
                        <tbody id="waitingTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é¡µæ§åˆ¶åŒºåŸŸ -->
                <div class="pagination" id="waitingPagination">
                    <button onclick="prevWaitingPage()" id="prevWaitingBtn">ä¸Šä¸€é¡µ</button>
                    <span id="waitingPageInfo">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                    <button onclick="nextWaitingPage()" id="nextWaitingBtn">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- å‡åˆ‘ç­›æŸ¥æ•°æ®æ ‡ç­¾é¡µ -->
        <div id="screening-tab" class="tab-content visitor-only">

            <div id="screening-content" style="display: none;">
                <div class="stats">
                    <div class="stat-card">
                        <h3>æ€»è®°å½•æ•°</h3>
                        <div class="stat-card number" id="screeningTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>ç¬¦åˆå‡åˆ‘æ¡ä»¶</h3>
                        <div class="stat-card number" id="screeningEligible">0</div>
                    </div>
                </div>

                <div class="search-section">
                    <div class="search-row" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                        <div class="search-item" style="display: flex; align-items: center; gap: 6px; min-width: 200px;">
                            <label style="margin: 0; white-space: nowrap; font-size: 0.9em;">å§“å/å›šå·</label>
                            <input type="text" id="screeningSearch" placeholder="è¾“å…¥å§“åã€å›šå·æˆ–å§“åé¦–å­—æ¯" oninput="debouncedFilterScreeningData()" style="flex: 1; min-width: 120px;">
                        </div>
                        <div class="search-item" style="display: flex; align-items: center; gap: 6px; min-width: 150px;">
                            <label style="margin: 0; white-space: nowrap; font-size: 0.9em;">ç½ªå</label>
                            <select id="screeningCrime" onchange="filterScreeningData()" style="flex: 1; min-width: 100px;">
                                <option value="">å…¨éƒ¨ç½ªå</option>
                            </select>
                        </div>
                        <div class="search-item" style="display: flex; align-items: center; gap: 6px; min-width: 150px;">
                            <label style="margin: 0; white-space: nowrap; font-size: 0.9em;">å‡åˆ‘æ¨æµ‹ç»“è®º</label>
                            <select id="screeningConclusion" onchange="filterScreeningData()" style="flex: 1; min-width: 100px;">
                                <option value="">å…¨éƒ¨ç»“è®º</option>
                                <option value="ç¬¦åˆç”³æŠ¥æ¡ä»¶">ç¬¦åˆç”³æŠ¥æ¡ä»¶</option>
                                <option value="ç«‹å³å¯åŠ¨">ç«‹å³å¯åŠ¨</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="search-item button-group" style="margin: auto; display: flex; align-items: center; justify-content: center; padding: 8px;">
                            <button class="btn btn-secondary" onclick="resetScreeningFilters()" style="padding: 8px 16px; font-size: 1em;">ğŸ”„ é‡ç½®</button>
                        </div>
                    </div>
                </div>

                <div class="export-buttons admin-only">
                    <button class="btn btn-success" onclick="exportScreeningData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                </div>

                <div id="screeningTableContainer">
                    <table class="data-table" id="screeningTable">
                        <colgroup>
                            <col style="width: 60px;">  <!-- åºå· -->
                            <col style="width: 80px;">  <!-- å§“å -->
                            <col style="width: 100px;"> <!-- å›šå· -->
                            <col style="width: 180px;"> <!-- ç½ªå -->
                            <col style="width: 100px;"> <!-- åŸåˆ¤åˆ‘æœŸ -->
                            <col style="width: 100px;"> <!-- å‡åˆ‘æ¬¡æ•° -->
                            <col style="width: 100px;"> <!-- è€ƒæ ¸æœˆæ•° -->
                            <col style="width: 180px;"> <!-- å‡åˆ‘æ¨æµ‹ç»“è®º -->
                            <col style="width: 150px;"> <!-- å¤‡æ³¨ -->
                        </colgroup>
                        <thead>
                            <tr>
                                <th>åºå·</th>
                                <th>å§“å</th>
                                <th>å›šå·</th>
                                <th>ç½ªå</th>
                                <th>åŸåˆ¤åˆ‘æœŸ</th>
                                <th>å‡åˆ‘æ¬¡æ•°</th>
                                <th>è€ƒæ ¸æœˆæ•°</th>
                                <th>å‡åˆ‘æ¨æµ‹ç»“è®º</th>
                                <th>å¤‡æ³¨</th>
                            </tr>
                        </thead>
                        <tbody id="screeningTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é¡µæ§åˆ¶åŒºåŸŸ -->
                <div class="pagination" id="screeningPagination">
                    <button onclick="prevScreeningPage()" id="prevScreeningBtn">ä¸Šä¸€é¡µ</button>
                    <span id="screeningPageInfo">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                    <button onclick="nextScreeningPage()" id="nextScreeningBtn">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- åŠ æ‰£åˆ†å…¬ç¤ºè¡¨æ ‡ç­¾é¡µ -->
        <div id="score-tab" class="tab-content visitor-only">

            <div id="score-content" style="display: none;">
                <div class="stats">
                    <div class="stat-card">
                        <h3>æ€»è®°å½•æ•°</h3>
                        <div class="stat-card number" id="scoreTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>æ‰£åˆ†è®°å½•</h3>
                        <div class="stat-card number" id="scoreDeduction">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>æ¶‰åŠç½ªçŠ¯æ•°</h3>
                        <div class="stat-card number" id="scorePrisoners">0</div>
                    </div>
                </div>

                <div class="search-section">
                    <div class="search-row">
                        <div class="search-item">
                            <label>ç½ªçŠ¯ç¼–å·/å§“å</label>
                            <input type="text" id="scoreSearch" placeholder="è¾“å…¥ç¼–å·ã€å§“åæˆ–å§“åé¦–å­—æ¯" oninput="debouncedFilterScoreData()">
                        </div>
                        <div class="search-item">
                            <label>æ‰€å±åˆ†ç›‘åŒº</label>
                            <select id="scorePrison" onchange="filterScoreData()">
                                <option value="">å…¨éƒ¨åˆ†ç›‘åŒº</option>
                            </select>
                        </div>
                        <div class="search-item">
                            <label>æ‰£åˆ†ç±»åˆ«</label>
                            <select id="scoreCategory" onchange="filterScoreData()">
                                <option value="">å…¨éƒ¨ç±»åˆ«</option>
                            </select>
                        </div>
                        <div class="search-item" style="min-width: 200px;">
                            <label>åˆ›å»ºæ—¶é—´</label>
                            <input type="date" id="scoreDateFrom" style="width: 60%;" onchange="validateScoreDateRange(); filterScoreData()">
                            <span>è‡³</span>
                            <input type="date" id="scoreDateTo" style="width: 60%;" onchange="validateScoreDateRange(); filterScoreData()">
                        </div>
                        <div class="search-item" style="min-width: 180px;">
                            <label>æ‰£åˆ†åˆ†å€¼</label>
                            <input type="number" id="scoreValueMin" placeholder="æœ€å°å€¼" style="width: 48%;" oninput="debouncedFilterScoreData()">
                            <span>è‡³</span>
                            <input type="number" id="scoreValueMax" placeholder="æœ€å¤§å€¼" style="width: 48%;" oninput="debouncedFilterScoreData()">
                        </div>
                        <div class="search-item button-group">
                            <button class="btn btn-secondary" onclick="resetScoreFilters()">ğŸ”„ é‡ç½®</button>
                        </div>
                    </div>
                </div>

                <div class="export-buttons admin-only">
                    <button class="btn btn-success" onclick="exportScoreData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                </div>

                <div id="scoreTableContainer">
                    <table class="data-table" id="scoreTable">
                        <colgroup>
                            <col style="width: 60px;">  <!-- åºå· -->
                            <col style="width: 100px;"> <!-- ç½ªçŠ¯ç¼–å· -->
                            <col style="width: 80px;">  <!-- ç½ªçŠ¯å§“å -->
                            <col style="width: 100px;"> <!-- æ‰€å±åˆ†ç›‘åŒº -->
                            <col style="width: 120px;"> <!-- åˆ›å»ºæ—¶é—´ -->
                            <col style="width: 200px;"> <!-- äº‹å® -->
                            <col style="width: 80px;">  <!-- ç±»å‹ -->
                            <col style="width: 80px;">  <!-- ç±»åˆ« -->
                            <col style="width: 60px;">  <!-- åˆ†å€¼ -->
                            <col style="width: 80px;">  <!-- åˆ›å»ºäºº -->
                        </colgroup>
                        <thead>
                            <tr>
                                <th>åºå·</th>
                                <th>ç½ªçŠ¯ç¼–å·</th>
                                <th>ç½ªçŠ¯å§“å</th>
                                <th>æ‰€å±åˆ†ç›‘åŒº</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>äº‹å®</th>
                                <th>ç±»å‹</th>
                                <th>ç±»åˆ«</th>
                                <th>åˆ†å€¼</th>
                                <th>åˆ›å»ºäºº</th>
                            </tr>
                        </thead>
                        <tbody id="scoreTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é¡µæ§åˆ¶åŒºåŸŸ -->
                <div class="pagination" id="scorePagination">
                    <button onclick="prevScorePage()" id="prevScoreBtn">ä¸Šä¸€é¡µ</button>
                    <span id="scorePageInfo">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                    <button onclick="nextScorePage()" id="nextScoreBtn">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- åˆ‘åŠ¡å·¥ä½œæŒ‡å¼•æ ‡ç­¾é¡µ -->
        <div id="guidance-tab" class="tab-content visitor-only">
            <div class="guidance-container">
                <h2 style="text-align: center; color: #1e3a8a; margin-bottom: 20px;">åˆ‘åŠ¡å·¥ä½œæŒ‡å¼•</h2>
                <div class="guidance-cards">
                    <div class="guidance-card" onclick="openGuidancePage('meeting-minutes')">
                        <h3>2024å¹´çœæ³•é™¢ã€æ£€å¯Ÿé™¢ã€å…¬å®‰å…ã€å¸æ³•å…ã€ç›‘ç‹±å±€è”å¸­ä¼šè®®çºªè¦</h3>
                        <p>æŸ¥çœ‹è”å¸­ä¼šè®®çºªè¦å†…å®¹</p>
                    </div>
                    <div class="guidance-card" onclick="openGuidancePage('important-notes')">
                        <h3>é‡è¦è®°äº‹æ±‡æ€»</h3>
                        <p>æˆªæ­¢è‡³2024å¹´4æœˆ2æ—¥é‡è¦è®°äº‹æ±‡æ€»</p>
                    </div>
                    <div class="guidance-card" onclick="openGuidancePage('sentence-reduction-requirements')">
                        <h3>å‡åˆ‘èµ·å§‹é—´éš”æ—¶é—´å’Œå¹…åº¦ä»ä¸¥çš„è¦æ±‚</h3>
                        <p>ç°è¡Œæœ‰å…³å‡åˆ‘èµ·å§‹é—´éš”æ—¶é—´å’Œå¹…åº¦ä»ä¸¥çš„è¦æ±‚ï¼ˆ2025.7.18ï¼‰</p>
                    </div>
                    <div class="guidance-card" onclick="openGuidancePage('implementation-rules')">
                        <h3>å…³äºåŠç†å‡åˆ‘ã€å‡é‡Šæ¡ˆä»¶çš„å®æ–½ç»†åˆ™</h3>
                        <p>2019å¹´å®æ–½ç»†åˆ™</p>
                    </div>
                    <div class="guidance-card" onclick="openGuidancePage('sentence-reduction-conditions')">
                        <h3>å‡åˆ‘æ¡ä»¶è¯´æ˜</h3>
                        <p>å‡åˆ‘æ¡ä»¶è¯¦ç»†è¯´æ˜</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- ç‰ˆæƒä¿¡æ¯ -->
    <footer class="copyright-footer">
        <p class="footer-text">ä½œè€…ï¼šæƒ å·ç›‘ç‹±åäº”ç›‘åŒº</p>
        <div class="real-time-clock" id="realTimeClock">
            <span class="clock-time" id="clockTime">00:00:00</span>
            <span class="clock-date" id="clockDate">2025-01-01</span>
        </div>
        <div class="easter-eggs">
            <span class="easter-egg-item" id="egg1" title="ç‚¹å‡»æœ‰æƒŠå–œ">âœ¨</span>
            <span class="easter-egg-item" id="egg2" title="ç‚¹å‡»æœ‰æƒŠå–œ">ğŸ‰</span>
            <span class="easter-egg-item" id="egg3" title="ç‚¹å‡»æœ‰æƒŠå–œ">ğŸ’¡</span>
        </div>
    </footer>

    <!-- å¼•ç”¨XLSXåº“ç”¨äºExcelæ–‡ä»¶å¤„ç† -->
    <script src="asset/js/xlsx.full.min.js"></script>
    
    <!-- å¼•å…¥æ‹¼éŸ³è½¬æ¢åº“ -->
    <script src="asset/js/select2-pinyin-master/pinyin.js"></script>
    
    <!-- å¼•å…¥å¤–éƒ¨JavaScriptæ¨¡å— -->
    <script src="asset/js/common.js"></script>
    <script src="asset/js/analysis-tab.js"></script>
    <script src="asset/js/waiting-tab.js"></script>
    <script src="asset/js/screening-tab.js"></script>
    <script src="asset/js/score-tab.js"></script>
    
    <!-- åŠ è½½ä½™åˆ‘æ•°æ® -->
    <script src="asset/js/load-data.js"></script>

    <script>
        // åˆå§‹åŒ– - é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            autoLoadAllData();
        });
    </script>

    <!-- ç™»å½•è¡¨å• -->
    <div id="loginForm" class="login-form">
        <h3>ç®¡ç†å‘˜ç™»å½•</h3>
        <input type="text" id="username" placeholder="ç”¨æˆ·å" value="admin" onkeydown="handleLoginKeyPress(event)">
        <input type="password" id="password" placeholder="å¯†ç " value="admin123" onkeydown="handleLoginKeyPress(event)">
        <button onclick="login()">ç™»å½•</button>
        <button onclick="hideLoginForm()" class="cancel-btn">å–æ¶ˆ</button>
    </div>

    <!-- é€€å‡ºæç¤ºå¼¹çª— -->
    <div id="logoutMessage" class="logout-message" style="display: none;">
        <div class="logout-content">
            <div class="logout-icon">âœ“</div>
            <h3>å·²é€€å‡ºç®¡ç†å‘˜æ¨¡å¼</h3>
            <p>æ‚¨å·²æˆåŠŸé€€å‡ºç®¡ç†å‘˜æ¨¡å¼ï¼Œç°åœ¨ä»¥è®¿å®¢èº«ä»½è®¿é—®ç³»ç»Ÿã€‚</p>
            <button onclick="closeLogoutMessage()">ç¡®å®š</button>
        </div>
    </div>

    <script>
        // å¤„ç†ç™»å½•è¡¨å•çš„å›è½¦é”®
        function handleLoginKeyPress(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault(); // é˜²æ­¢é»˜è®¤è¡Œä¸º
                login();
            }
        }

        // å®æ—¶æ—¶é—´æ›´æ–°
        function updateRealTime() {
            var now = new Date();
            var hours = String(now.getHours()).padStart(2, '0');
            var minutes = String(now.getMinutes()).padStart(2, '0');
            var seconds = String(now.getSeconds()).padStart(2, '0');
            var year = now.getFullYear();
            var month = String(now.getMonth() + 1).padStart(2, '0');
            var day = String(now.getDate()).padStart(2, '0');
            var weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            var weekday = weekdays[now.getDay()];

            var clockTimeEl = document.getElementById('clockTime');
            var clockDateEl = document.getElementById('clockDate');

            if (clockTimeEl) {
                clockTimeEl.textContent = hours + ':' + minutes + ':' + seconds;
            }
            if (clockDateEl) {
                clockDateEl.textContent = year + '-' + month + '-' + day + ' æ˜ŸæœŸ' + weekday;
            }
        }

        // åˆå§‹åŒ–å®æ—¶æ—¶é’Ÿ
        document.addEventListener('DOMContentLoaded', function() {
            updateRealTime();
            setInterval(updateRealTime, 1000);
        });

        // å½©è›‹ç‚¹å‡»æ•ˆæœ
        function createParticle(x, y, emoji) {
            var particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = emoji;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            document.body.appendChild(particle);

            setTimeout(function() {
                particle.remove();
            }, 1500);
        }

        function handleEasterEggClick(event, eggId) {
            var egg = document.getElementById(eggId);
            if (!egg) return;

            // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
            egg.classList.add('easter-egg-click');
            setTimeout(function() {
                egg.classList.remove('easter-egg-click');
            }, 600);

            // åˆ›å»ºç²’å­æ•ˆæœ
            var rect = egg.getBoundingClientRect();
            var x = rect.left + rect.width / 2;
            var y = rect.top + rect.height / 2;
            
            var emojis = ['âœ¨', 'â­', 'ğŸ’«', 'ğŸŒŸ', 'ğŸŠ', 'ğŸˆ', 'ğŸ', 'ğŸ€'];
            var clickedEmoji = egg.textContent;

            // åˆ›å»ºå¤šä¸ªç²’å­
            for (var i = 0; i < 8; i++) {
                (function(index) {
                    setTimeout(function() {
                        var randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                        var offsetX = (Math.random() - 0.5) * 100;
                        var offsetY = (Math.random() - 0.5) * 100;
                        createParticle(x + offsetX, y + offsetY, randomEmoji);
                    }, index * 50);
                })(i);
            }

            // æ˜¾ç¤ºä¸åŒçš„æ¶ˆæ¯
            var messages = {
                'egg1': ['âœ¨ æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½é—ªé—ªå‘å…‰ï¼', 'âœ¨ åŠ æ²¹ï¼ä½ æ˜¯æœ€æ£’çš„ï¼', 'âœ¨ ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡å“¦ï¼'],
                'egg2': ['ğŸ‰ æ­å–œä½ å‘ç°äº†å½©è›‹ï¼', 'ğŸ‰ ç”Ÿæ´»éœ€è¦ä¸€ç‚¹å°æƒŠå–œï¼', 'ğŸ‰ æ„¿ä½ æ¯å¤©éƒ½å……æ»¡æ¬¢ä¹ï¼'],
                'egg3': ['ğŸ’¡ çµæ„Ÿä¸€é—ªè€Œè¿‡ï¼', 'ğŸ’¡ ä¿æŒå¥½å¥‡å¿ƒï¼', 'ğŸ’¡ æ™ºæ…§å¦‚å…‰ï¼Œç…§äº®å‰è·¯ï¼']
            };

            var messageList = messages[eggId] || ['ğŸŠ å‘ç°äº†å½©è›‹ï¼'];
            var randomMessage = messageList[Math.floor(Math.random() * messageList.length)];

            // åˆ›å»ºä¸´æ—¶æç¤ºæ¶ˆæ¯
            var toast = document.createElement('div');
            toast.textContent = randomMessage;
            toast.style.position = 'fixed';
            toast.style.top = '50%';
            toast.style.left = '50%';
            toast.style.transform = 'translate(-50%, -50%)';
            toast.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1e3a8a 100%)';
            toast.style.color = 'white';
            toast.style.padding = '20px 40px';
            toast.style.borderRadius = '12px';
            toast.style.fontSize = '18px';
            toast.style.fontWeight = '600';
            toast.style.zIndex = '10000';
            toast.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.3)';
            toast.style.animation = 'fadeInOut 2s ease-out forwards';
            toast.style.pointerEvents = 'none';
            document.body.appendChild(toast);

            setTimeout(function() {
                toast.remove();
            }, 2000);
        }

        // æ·»åŠ CSSåŠ¨ç”»
        var style = document.createElement('style');
        style.textContent = '@keyframes fadeInOut {' +
            '0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }' +
            '20%, 80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }' +
            '100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }' +
        '}';
        document.head.appendChild(style);

        // ç»‘å®šå½©è›‹ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            var eggs = ['egg1', 'egg2', 'egg3'];
            for (var i = 0; i < eggs.length; i++) {
                var eggId = eggs[i];
                var egg = document.getElementById(eggId);
                if (egg) {
                    egg.addEventListener('click', function(e) {
                        handleEasterEggClick(e, eggId);
                    });
                }
            }
        });
    </script>
</body>
</html>
